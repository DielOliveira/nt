<script src="/assets/template/countdown/jquery.countdown.min.js"></script>

<%= form_for @doacao, html: { multipart: true } do |f| %>

<% @doacaoverifica =  Doacao.find_by_id(@doacao.id)%>

  <% if @doacao.errors.any? %>
    <div class="alert alert-danger alert-dismissible fade in" role="alert">
    <button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
  
  <% if @doacao.errors.any? %>
  
    <% @doacao.errors.full_messages.each do |msg| %>
        <%= msg %></br>
      <% end %>
     <% end %>
    </div>
  <% end %>  
  
  
<%
      @dadosfinanceiros = Dadosfinanceiro.find_by_cadastro_id(@doacao.cadastro_recebedor.id) rescue nil
%>

<%@adjusted_datetime = (@doacao.created_at + 1.days).to_datetime %>
<%@adjusted_datetime = @adjusted_datetime.strftime("%Y/%m/%d %H:%M") %>

<div class="box box-warning">
    <div class="box-header with-border">

    <% if user.cadastro.id == @doacao.cadastro_doador.id%>
      <h4 class="timeline-header"><a href="#">Doação para: <%=@doacao.cadastro_recebedor.nomepessoa%>!</a></h4>
    <%else%>
      <h4 class="timeline-header"><a href="#">Doação de: <%=@doacao.cadastro_doador.nomepessoa%>!</a></h4>
    <%end%>

      <div class="box-tools pull-right">
        <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
        </button>
      </div>
    </div>
    <div class="box-body">
      <p><b>Banco: </b><%=@dadosfinanceiros.banco.nomebanco%></p>
      <p><b>Agencia: </b><%=@dadosfinanceiros.agencia%></p>
      <p><b>Conta: </b><%=@dadosfinanceiros.codigo%></p>
      <p><b>Titular: </b><%=@dadosfinanceiros.nometitular%></p>
      <p><b>CPF: </b><%=@dadosfinanceiros.cpftitular%></p>
      <p><b>Tempo Restante: </b><i class="fa fa-clock-o"></i> <span id="clock"></span></small></p>
      <br>
      <% if not @doacao.avatar? %>
      <p><b>Comprovante </b></p>
        <%= f.file_field :avatar %>
      <%else%>
        <%= f.hidden_field :avatar %>
      <% end %>

      <%= f.hidden_field :flagenviada, :value => true %>

      <%#= f.hidden_field :whatsapp, :class => 'form-control'%>

      <div class="timeline-footer">
        <div align="right">

        <% if @doacao.avatar? %>
          <%= link_to @doacao.avatar_url , :class => "btn btn-info btn-sm", :target => "_blank" do %>
             Ver Comprovante
          <% end %>   
        <% end %>   

        <% if not @doacaoverifica.flagenviada? %>
          <button type="submit" class="btn btn-success btn-bg">
            Realizar Doação
          </button>
        <%end%>
      </div>

      </div>              
    </div>
</div>        
            
<% end %>


<script type="text/javascript">
$('#clock').countdown("<%=@adjusted_datetime%>", function(event) {
 var totalHours = event.offset.totalDays * 24 + event.offset.hours;
 $(this).html(event.strftime(totalHours + ' hr %M min %S sec'));
});   
</script>  